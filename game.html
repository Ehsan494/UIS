<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>APS Interactive Story</title>
  <style>
    /* ←———————————————————————————————————————————————————————————————
       General page styles
    ————————————————————————————————————————————————————————————————→ */
    html, body { margin:0; padding:0; height:100%; overflow:hidden; }
    body { 
      font-family: 'Segoe UI', sans-serif; 
      background: linear-gradient(135deg,#f0f4f8,#d9e2ec);
      color: #102a43;
      display: flex;
      flex-direction: column;
    }
    #container { flex:1; display:flex; }
    #narrative {
      width: 35%; padding: 30px; box-sizing: border-box;
      background: #fff; border-right:1px solid #ccc;
      display:flex; flex-direction:column;
    }
    #narrative h1 { margin-top:0; font-size:1.6em; }
    #narrative p { flex:1; line-height:1.4; }
    #nextBtn {
      padding:12px 20px; font-size:1em;
      background:#486581; color:#fff; border:none; border-radius:4px;
      cursor:pointer; transition: background .2s ease;
      align-self:flex-end;
    }
    #nextBtn:hover { background:#334e68; }

    #sim {
      flex:1; position:relative; display:flex;
      align-items:center; justify-content:center;
    }
    .box {
      width:120px; min-height:150px; margin:0 10px;
      background:rgba(255,255,255,0.8); border:2px solid #bcccdc;
      border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1);
      padding:10px; box-sizing:border-box;
      display:flex; flex-wrap:wrap; align-content:flex-start;
    }
    .box h3 {
      margin:0 0 8px 0; font-size:1em; text-align:center;
      color:#334e68;
    }
    .item {
      width:30px; height:30px; border-radius:50%;
      background:#627d98; color:#fff; display:flex;
      align-items:center; justify-content:center;
      margin:5px; font-weight:bold; transition: transform .5s ease, background .3s;
    }
    .host { background:#d64545 !important; }
    .R    { background:#f08a24 !important; }
    .RK   { background:#60a3bc !important; }
    .RKp  { background:#9b59b6 !important; }
    .NDS  { background:#2ecc71 !important; }

    /* fade animation */
    .fade {
      opacity:0; transition:opacity .5s ease;
    }
    .fade.show { opacity:1; }

    /* Hide for story steps */
    .hidden { visibility:hidden; }

  </style>
</head>
<body>

  <!-- Background music -->
  <audio id="bgm" src="background.mp3" loop autoplay></audio>

  <div id="container">
    <div id="narrative">
      <h1>Arena-Principle Sorting</h1>
      <p id="text">Welcome!  In this interactive story you’ll discover how APS peels off the Pareto front, one “host” at a time.</p>
      <button id="nextBtn">Next &raquo;</button>
    </div>
    <div id="sim">
      <div class="box" id="box-Q"><h3>Q</h3></div>
      <div class="box" id="box-R"><h3>R</h3></div>
      <div class="box" id="box-RK"><h3>RK</h3></div>
      <div class="box" id="box-RKp"><h3>RK′</h3></div>
      <div class="box" id="box-NDS"><h3>NDS</h3></div>
    </div>
  </div>

  <script>
  // —————————————————————————————————————————
  // 1) Story frames
  // —————————————————————————————————————————
  const story = [
    "We have a population Q of 6 solutions (A–F) in a 2D objective space.  Let’s begin!",
    "Step 1: Pick a random \"host\" x from Q.  The host sits in the red slot.",
    "Step 2: Compare each remaining y in Q to the host x, one by one:",
    "- If x ≺ y, drop y.",
    "- If y ≺ x, y becomes the new host and R empties into RK.",
    "- If neither dominates, move y to R.",
    "Step 3: Once Q is empty, compute RK′ as those in RK not dominated by x.",
    "Step 4: Add the final host x to NDS (green).",
    "Step 5: Build new Q = RK′ ∪ R and repeat until Q vanishes.",
    "And that’s how APS peels off one Pareto front at a time!"
  ];
  let step = 0;

  // —————————————————————————————————————————
  // 2) Simulation state and helpers
  // —————————————————————————————————————————
  const points = ['A','B','C','D','E','F'];
  let Q, R, RK, RKp, host, NDS;

  function dominates(a,b){
    // fake coords: order by letter for demo
    return a < b;
  }

  function initState(){
    Q = [...points];
    R = []; RK = []; RKp = []; NDS = [];
    host = null;
    renderAll();
  }

  function createItem(label){
    const d = document.createElement('div');
    d.textContent = label;
    d.className = 'item fade';
    setTimeout(()=>d.classList.add('show'),50);
    return d;
  }

  function renderBox(id, arr, cls){
    const box = document.getElementById('box-'+id);
    box.querySelectorAll('.item').forEach(n=>n.remove());
    arr.forEach(l=>{
      const it = createItem(l);
      if(cls) it.classList.add(cls);
      box.appendChild(it);
    });
  }

  function renderAll(){
    renderBox('Q', Q, '');
    renderBox('R', R, 'R');
    renderBox('RK', RK, 'RK');
    renderBox('RKp', RKp, 'RKp');
    renderBox('NDS', NDS, 'NDS');
  }

  // —————————————————————————————————————————
  // 3) Story/narrative progression
  // —————————————————————————————————————————
  const txt = document.getElementById('text');
  const btn = document.getElementById('nextBtn');
  btn.onclick = ()=> {
    if(step === 0){
      txt.textContent = story[++step];
      // initialize
      initState();
    }
    else if(step === 1){
      // pick host
      host = Q.splice(Math.floor(Math.random()*Q.length),1)[0];
      document.getElementById('box-Q').classList.add('fade');
      txt.textContent = `Host = ${host}.  Now compare each remaining Q item in turn.`;
      renderAll();
      step++;
    }
    else if(step >= 2 && step <= 2 + points.length - 1){
      // compare next Q
      if(Q.length){
        const y = Q.shift();
        if(dominates(host,y)){
          // host dominates y
        } else if(dominates(y,host)){
          // y becomes host
          RK.push(...R);
          R = [];
          host = y;
        } else {
          // incomparable
          R.push(y);
        }
        txt.textContent = story[2] + ` (compared ${y})`;
        renderAll();
      } else {
        step = 2 + points.length;
        txt.textContent = story[5];
      }
    }
    else if(step === 2 + points.length){
      // compute RK′
      RKp = RK.filter(z=>!dominates(host,z));
      txt.textContent = story[++step];
      renderAll();
    }
    else if(step === 5 + points.length){
      // add host to NDS
      NDS.push(host);
      txt.textContent = story[++step];
      renderAll();
    }
    else if(step === 6 + points.length){
      // rebuild Q
      Q = [...RKp, ...R];
      R = []; RK = []; RKp = [];
      txt.textContent = story[++step];
      renderAll();
    }
    else {
      txt.textContent = story[++step] || "Done!";
      btn.disabled = true;
    }
  };

  // start paused
  step = 0;

  // autoplay music
  document.getElementById('bgm').volume = 0.2;
  </script>
</body>
</html>
